<html>
<head>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="cheep.css"/>
</head>

<body>
<div id="screen">

    <div id="search_header">
        <!--<div id="bird_wrapper">-->
            <!--<img id="bird" src="images/bird.png">-->
        <!--</div>-->

        <!--<a href="search_entry.html">-->
            <div id="search">
                <span class="material_icons" id="search_icon">search</span>
                <input type="text" id="search_field" onkeydown="if (event.keyCode === 13){searchProductData();}">

                <div id="search_window">
                    <div id="SE_close">
                        <a href="results.html"><span class="material_icons" id="SE_close_icon"> close </span></a>
                    </div>

                    <div id="SE_search_container">
                        <span class="material_icons" id="SE_search_icon"> search </span>
                        <input type="text" id="SE_search_field" placeholder="Search...">
                    </div>

                    <div id="SE_search_history">
                        <div id="SE_search_history_title"> <span class="material_icons"> history </span> RECENT SEARCHES </div>
                        <ul>
                            <li> <a href="results.html">Milk</a></li>
                            <li> Eggs </li>
                            <li> Flour </li>
                            <li> Oil </li>
                            <li> Syrup </li>
                        </ul>
                    </div>
                </div>

            </div>

        <div id="filter_icon_wrapper" onclick="showFilter()">
            <span id="filter_icon" class="material_icons">tune</span>
        </div>
        <!--</a>-->
    </div>

    <div id="menu">
        <div class="menu_tab" style="background-color: #f9ef90;">
            <!--<img id="mag_glass" src="images/mag_glass.png" style="width: 40px;">-->
            <div class="material_icon_footer"> search </div>
        </div>
        <div class="menu_tab">
            <!--<img id="shop_cart" src="images/shop_cart.png" style="width: 40px;">-->
            <div class="material_icon_footer"> shopping_cart </div>
        </div>
        <a href="user_profile.html" class="menu_tab">
            <!--<a href="user_profile.html" style="text-decoration: none; color: black;"><img id="profile" src="images/profile.svg" style="width: 40px;"></a>-->
            <div class="material_icon_footer"> account_circle </div>
        </a>
    </div>

<div id="results">
    <div id="result_list">

        <!--FORMAT FOR RESULT-->

        <!--<div class="result">-->
            <!--<div class="result_img_wrapper">-->
                <!--<img src="https://images-na.ssl-images-amazon.com/images/I/81uQm2SqxhL._SY606_.jpg" class="result_img">-->
            <!--</div>-->
            <!--<h1> Tuscan Dairy whole milk</h1>-->
            <!--<h2> 1 gal</h2>-->
            <!--<span class="result_price"> $2.99 - $4.99</span>-->

            <!--<div class="result_lower">-->
                <!--<div class="result_store_list">-->
                    <!--<img src="images/logos/d&d2.png" class="result_store_logo">-->
                    <!--<img src="images/logos/jewel.png" class="result_store_logo">-->
                    <!--<img src="images/logos/target.gif" class="result_store_logo">-->
                    <!--<img src="images/logos/traderjoes.jpg" class="result_store_logo">-->
                    <!--<img src="images/logos/wholefoods.png" class="result_store_logo">-->
                <!--</div>-->
                <!--<button class="result_add" content="Add"> Add </button>-->
            <!--</div>-->

    </div>
</div>

<div id="filter_popup">
    <div id="dark_box"></div>
    <div id="filter_content">
        <div id="filter_header">
            <button id="filter_close" onclick="hideFilter()"> <span class="material_icons"> arrow_back_ios </span> </button>
            <button id="filter_clear_button" onclick="clearFilters()"> Clear </button>
            <button id="filter_apply_button" onclick="applyFilters()"> Apply </button>
        </div>

        <div id="filter_content_wrapper">
            <!--<fieldset>-->
            <h1> Stores </h1>
            <p>
                <div id="DDs_button" class="filter_option">
                    D&D's
                    <span style="float: right"><input type="checkbox" id="DDs_box"></span>
                </div>
                <div id="Jewel_button" class="filter_option">
                    Jewel Osco
                    <span style="float: right"><input type="checkbox" id="Jewel_box"></span>
                </div>
                <div id="Target_buton" class="filter_option">
                    Target
                    <span style="float: right"><input type="checkbox" id="Target_box"></span>
                </div>
                <div id="TJ_button" class="filter_option">
                    Trader Joe's
                    <span style="float: right"><input type="checkbox" id="TJ_box"></span>
                </div>
                <div id="WF_button" class="filter_option">
                    Whole Foods
                    <span style="float: right"><input type="checkbox" id="WF_box"></span>
                </div>
            </p>
<!--        </br>-->


            <h1> Price </h1>
            Min: $
            <input type="text" id="filter_price_low" class="filter_price_field" >
            <br>
            Max: $
            <input type="text" id="filter_price_high" class="filter_price_field" >


            <!--</fieldset>-->
        </div>
    </div>
</div>


</div>



    <script src="results.js"></script>

        <!-- The core Firebase JS SDK is always required and must be listed first -->
        <script src="https://www.gstatic.com/firebasejs/6.0.2/firebase-app.js"></script>
        <script src="https://www.gstatic.com/firebasejs/3.1.0/firebase-database.js"></script>

        <!-- TODO: Add SDKs for Firebase products that you want to use
             https://firebase.google.com/docs/web/setup#config-web-app -->

        <script>
            // Your web app's Firebase configuration
            var firebaseConfig = {
                apiKey: "AIzaSyDnOwuo2b9OnJsVH0ErxUgarks1iKFDRM8",
                authDomain: "cheep-app.firebaseapp.com",
                databaseURL: "https://cheep-app.firebaseio.com",
                projectId: "cheep-app",
                storageBucket: "cheep-app.appspot.com",
                messagingSenderId: "17385407188",
                appId: "1:17385407188:web:b41fa17aaeda8b52"
            };
            // Initialize Firebase
            firebase.initializeApp(firebaseConfig);
        </script>

        <script>
            function hideFilter(){

                console.log('Hide Function Called');

                document.getElementById('filter_popup').style.display = "none";

            }

            function showFilter(){

                console.log('Show Function Called');

                document.getElementById('filter_popup').style.display = "block";

            }
        </script>

        <script>
            function applyFilters(){

                //order: D&D's, Jewel, Target, Trader Joe's, Whole Foods

                var stores = ["DDs","Jewel","Target","TJ","WF"];

                var filters = [];

                for(let i = 0; i<5; i++){
                    filters.push(document.getElementById(stores[i] + "_box").checked ? 1:0)
                }

                sessionStorage.setItem('filterValues',JSON.stringify(filters));

                var rangeMin = document.getElementById('filter_price_low').value;
                var rangeMax = document.getElementById('filter_price_high').value;

                sessionStorage.setItem('filterRange',JSON.stringify([rangeMin,rangeMax]));

                console.log(filters);

                var storeKeys = ["D & D's","Jewel Osco","Target","Trader Joe's","Whole Foods"];
                var searchResults = JSON.parse(sessionStorage.getItem('searchResults'));
                var newSearchResults = [];
                var changed = false;

                if(filters.reduce((a,b) => a+b,0) > 0){

                    changed = true;

                    for(let i = 0; i<searchResults.length; i++){

                        for(let j = 0; j<5; j++){

                            if(filters[j]==1 && searchResults[i][storeKeys[j]+" Price"] !== ""){
                                newSearchResults.push(searchResults[i]);
                                break;
                            }//end if

                        }//end prices for

                    }//end search results for

                }//end if filter by stores

                if(changed){
                    searchResults = newSearchResults;
                    newSearchResults = [];
                }

                changed = false;

                if(rangeMin != "" || rangeMax != ""){

                    console.log('CHANGING BASED ON RANGE');

                    changed = true;

                    for(let i = 0; i<searchResults.length; i++){

                        var itemPrices = [];

                        for(let j = 0; j<5; j++){

                            var price = searchResults[i][storeKeys[j]+" Price"];

                            if(price !== ""){
                                itemPrices.push(price);
                            }

                        }//end prices for

                        var itemPriceMin = Math.min.apply(null,itemPrices);
                        var itemPriceMax = Math.max.apply(null,itemPrices);

                        console.log([itemPriceMin,itemPriceMax]);

                        if(rangeMin != "" && rangeMax !=""){
                            if(itemPriceMin > parseFloat(rangeMin) || itemPriceMax < parseFloat(rangeMax)) {
                                newSearchResults.push(searchResults[i]);
                            }
                        }
                        else if(rangeMin != ""){
                            if(itemPriceMin > parseFloat(rangeMin)){
                                newSearchResults.push(searchResults[i]);
                            }
                        }
                        else if(rangeMax != ""){
                            if(itemPriceMax < parseFloat(rangeMax)){
                                newSearchResults.push(searchResults[i]);
                            }
                        }

                    }//end search results for

                }//end if filter by price

                if(changed){
                    sessionStorage.setItem('searchResults',JSON.stringify(newSearchResults));
                }

                console.log(newSearchResults);

                window.location.href = 'results.html';

            }
        </script>

        <script>
            function initFilterValues(){

                var stores = ["DDs","Jewel","Target","TJ","WF"];

                if(sessionStorage.getItem('filterValues') == undefined){
                    var filterValues = [0,0,0,0,0];
                }
                else {
                    var filterValues = JSON.parse(sessionStorage.getItem('filterValues'));
                }

                for(let i = 0; i<filterValues.length; i++){

                    document.getElementById(stores[i] + "_box").checked = !!filterValues[i];

                }

                if(sessionStorage.getItem('filterRange') != undefined){

                    var filterRange = JSON.parse(sessionStorage.getItem('filterRange'));
                    console.log(filterRange);

                    if(filterRange[0] != ""){
                        document.getElementById('filter_price_low').value = filterRange[0];
                    }
                    if(filterRange[1] != ""){
                        document.getElementById('filter_price_high').value = filterRange[1];
                    }
                }

            }
            initFilterValues();
        </script>

        <script>
            function clearFilters(){

                sessionStorage.setItem('filterValues',JSON.stringify([0,0,0,0,0]));
                sessionStorage.setItem('filterRange',JSON.stringify(["",""]));

                document.getElementById('search_field').value = sessionStorage.getItem('searchText');

                searchProductData();

            }
        </script>

    </body>


</html>